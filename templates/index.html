<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <title>Citizen Portal</title>
</head>
<body>
    <h1>Citizen Services Portal</h1>
    <div id="services"></div>
    <script src="/static/script.js"></script>
</body>
</html> -->

<!doctype html> 
<html lang="en"> 
<head> 
    <meta charset="utf-8"> 
    <title>Citizen Services Portal</title> 
    <link rel="stylesheet" href="/static/style.css"> 
</head> 
<body> 
    <div class="container"> 
        <aside class="sidebar"> 
            <h2>Ministries</h2> 
            <ul id="service-list"></ul> 
        <div class="lang-switch"> 
            <button onclick="setLang('en')">English</button> 
            <button onclick="setLang('si')">‡∑É‡∑í‡∂Ç‡∑Ñ‡∂Ω</button> 
            <button onclick="setLang('ta')">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</button> 
        </div> 
        </aside> 
        <section class="middle"> 
            <h2 id="sub-title">Select Subservice</h2> 
            <ul id="sub-list"></ul> 
        </section> 
        <main class="content"> 
            <h2 id="q-title">Select Question</h2> 
            <ul id="question-list"></ul> 
            <div id="answer-box"></div> 
        </main> 
    </div> 
    <script src="/static/script.js"></script> 

    <!-- ============================================ -->
    <!-- ADD THIS: AI CHAT WIDGET -->
    <!-- ============================================ -->
    <div id="chatWidget" style="position: fixed; bottom: 20px; right: 20px; z-index: 1000;">
        <button id="chatButton" style="width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.3);">üí¨</button>

        <div id="chatWindow" style="display: none; position: fixed; bottom: 90px; right: 20px; width: 350px; height: 500px; background: white; border-radius: 10px; box-shadow: 0 8px 24px rgba(0,0,0,0.3); flex-direction: column;">
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; display: flex; justify-content: space-between;">
                <h3 style="margin: 0;">ü§ñ AI Assistant</h3>
                <button id="closeChat" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer;">√ó</button>
            </div>

            <div id="chatMessages" style="flex: 1; overflow-y: auto; padding: 15px; background: #f5f5f5;">
                <div style="background: white; padding: 10px; border-radius: 8px;">üëã Hello! Ask me anything about government services!</div>
            </div>

            <div style="padding: 15px; background: white; border-top: 1px solid #ddd; display: flex; gap: 10px;">
                <input id="chatInput" type="text" placeholder="Type your question..." style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 20px;" />
                <button id="sendMessage" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer;">Send</button>
            </div>
        </div>
    </div>

    <script>
    const chatButton = document.getElementById('chatButton');
    const chatWindow = document.getElementById('chatWindow');
    const closeChat = document.getElementById('closeChat');
    const chatMessages = document.getElementById('chatMessages');
    const chatInput = document.getElementById('chatInput');
    const sendMessage = document.getElementById('sendMessage');

    chatButton.onclick = () => chatWindow.style.display = chatWindow.style.display === 'none' ? 'flex' : 'none';
    closeChat.onclick = () => chatWindow.style.display = 'none';

    async function sendChatMessage() {
        const message = chatInput.value.trim();
        if (!message) return;

        addMessage(message, 'user');
        chatInput.value = '';

        const typing = addMessage('Typing...', 'bot');

        try {
            const res = await fetch('/api/ai/search', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ query: message })
            });
            const data = await res.json();
            typing.remove();
            
            let answer = data.answer;
            if (data.sources && data.sources.length > 0) {
                answer += '\n\nüìö Sources:\n' + data.sources.map(s => '‚Ä¢ ' + s.title).join('\n');
            }
            addMessage(answer, 'bot');
        } catch (error) {
            typing.remove();
            addMessage('Sorry, something went wrong.', 'bot');
        }
    }

    function addMessage(text, type) {
        const div = document.createElement('div');
        div.style.cssText = `padding: 10px; margin-bottom: 10px; border-radius: 8px; white-space: pre-wrap; ${type === 'user' ? 'background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; margin-left: 50px; text-align: right;' : 'background: white; margin-right: 50px;'}`;
        div.textContent = text;
        chatMessages.appendChild(div);
        chatMessages.scrollTop = chatMessages.scrollHeight;
        return div;
    }

    chatInput.onkeypress = (e) => { if (e.key === 'Enter') sendChatMessage(); };
    sendMessage.onclick = sendChatMessage;
    </script>

</body> 
</html>
